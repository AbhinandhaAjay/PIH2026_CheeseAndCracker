# Render Blueprint for Siren Accident Detection System
# This file defines the 4 services required for the project.
services:
  # 1. Django Backend (Management API)
  - type: web
    name: siren-django-backend
    env: docker
    dockerContext: ./siren-backend
    dockerfilePath: Dockerfile.backend
    preDeployCommand: python manage.py migrate
    plan: starter # ML/Video processing needs at least 512MB-1GB
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: siren-db
          property: connectionString
      - key: PORT
        value: 8000
      - key: DJANGO_DEBUG
        value: "False"
      - key: DJANGO_ALLOWED_HOSTS
        fromContext: "RENDER_EXTERNAL_HOSTNAME"
      - key: GOOGLE_API_KEY
        sync: false # User must set this manually in Render dashboard
      - key: DJANGO_SECRET_KEY
        generateValue: true

  # 2. Django Frontend (Admin Dashboard Interface)
  - type: web
    name: siren-django-frontend
    env: docker
    dockerContext: ./siren-backend
    dockerfilePath: Dockerfile.frontend
    plan: starter
    envVars:
      - key: PORT
        value: 3000
      - key: REACT_APP_API_URL
        fromService:
          name: siren-django-backend
          type: web
          property: host

  # 3. Flask Backend (AI/ML Engine)
  - type: web
    name: siren-flask-backend
    env: docker
    dockerContext: ./flask_engine
    dockerfilePath: Dockerfile.backend
    plan: starter
    envVars:
      - key: PORT
        value: 5000
      - key: DJANGO_API_URL
        fromService:
          name: siren-django-backend
          type: web
          property: host
      - key: GOOGLE_API_KEY
        sync: false

  # 4. Flask Frontend (Analysis Interface)
  - type: web
    name: siren-flask-frontend
    env: docker
    dockerContext: ./flask_engine/frontend
    dockerfilePath: Dockerfile.frontend
    plan: starter
    envVars:
      - key: PORT
        value: 3000
      - key: REACT_APP_FLASK_API_URL
        fromService:
          name: siren-flask-backend
          type: web
          property: host

databases:
  - name: siren-db
    databaseName: siren
    user: siren_user
    plan: free # Can be upgraded later
